from config import (
    SECRET_CODE
)
import logging as log
import httpx
from loader import *
from aiogram.dispatcher.middlewares import BaseMiddleware
from aiogram.dispatcher.handler import CancelHandler
from time import time

log.basicConfig(level=log.DEBUG)
logger = log.getLogger(__name__)

async def send_request(url, method="GET", headers=None, **kwargs):
    if headers is None:
        headers = {}
    headers["X-Secret-Code"] = SECRET_CODE  # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫

    async with httpx.AsyncClient() as client:
        try:
            # –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –∑–∞–ø—Ä–æ—Å–∞
            if method.upper() == "POST":
                response = await client.post(url, headers=headers, **kwargs)
            elif method.upper() == "GET":
                response = await client.get(url, headers=headers, **kwargs)
            elif method.upper() == "PUT":
                response = await client.put(url, headers=headers, **kwargs)
            elif method.upper() == "DELETE":
                response = await client.delete(url, headers=headers, **kwargs)
            else:
                raise ValueError(f"Unsupported HTTP method: {method}")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
            response.raise_for_status()  # –í—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫ —Å—Ç–∞—Ç—É—Å–∞

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type
            content_type = response.headers.get("Content-Type", "")

            if content_type.startswith("application/json"):
                return response.json()  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º JSON-–æ—Ç–≤–µ—Ç
            elif content_type.startswith("application/vnd.openxmlformats"):
                return response.content  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∞–π–ª)
            elif content_type.startswith("application/pdf"):
                return response.content  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∞–π–ª PDF)
            else:
                logger.error(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π Content-Type: {content_type}")
                return {"status": "error", "message": "–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞."}

        except httpx.RequestError as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞: {e}")
            return {"status": "error", "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É."}
        except httpx.HTTPStatusError as e:
            logger.error(f"HTTP —Å—Ç–∞—Ç—É—Å-–∫–æ–¥ {e.response.status_code}: {e}")
            return {"status": "error", "message": f"–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: {e.response.status_code}."}
        except Exception as e:
            logger.error(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
            return {"status": "error", "message": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞."}

class ThrottlingMiddleware(BaseMiddleware):
    def __init__(self, rate_limit=1):
        super().__init__()
        self.rate_limit = rate_limit
        self.user_timestamps = {}

    async def on_pre_process_message(self, message: Message, data: dict):
        user_id = message.from_user.id
        current_time = time()

        if user_id not in self.user_timestamps:
            self.user_timestamps[user_id] = current_time
            return
        
        last_time = self.user_timestamps[user_id]
        if current_time - last_time < self.rate_limit:
            await message.answer("–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
            raise CancelHandler()

        self.user_timestamps[user_id] = current_time

test_questions = [
    {
        "question": "–ó–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç k –≤ –º–æ–¥–µ–ª–∏ –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ y = kx + b?",
        "answers": ["–ù–∞–∫–ª–æ–Ω", "–û—Ç—Å—Ç—É–ø", "–î–ª–∏–Ω–∞", "–°–º–µ—â–µ–Ω–∏–µ"],
        "correct": 0
    },
    {
        "question": "–°—Ä–µ–¥–∏ –¥–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—Ç–∏–ª–∞—Å—å —Å—Ç—Ä–æ—á–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ä–æ—Å—Ç —á–µ–ª–æ–≤–µ–∫–∞ —Ä–∞–≤–µ–Ω 300 –º–µ—Ç—Ä–∞–º. –¢–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —è–≤–ª—è–µ—Ç—Å—è...",
        "answers": ["–ù–æ–Ω—Å–µ–Ω—Å", "–®—É–º–æ–º", "–í—ã–±—Ä–æ—Å–æ–º", "–ì–ª—é–∫–æ–º"],
        "correct": 2
    },
    {
        "question": "–í –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –≤—Ö–æ–¥–∏—Ç —É–¥–∞–ª–µ–Ω–∏–µ ...",
        "answers": ["–î—É–±–ª–∏–∫–∞—Ç–æ–≤", "–í—ã–±—Ä–æ—Å–æ–≤", "–ü—Ä–µ–¥–∏–∫—Ç–æ—Ä–æ–≤", "–û—à–∏–±–æ–∫"],
        "correct": 2
    },
    {
        "question": "–ú–µ–∂–¥—É —É–º–æ–º –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–º –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –µ—ë –µ—â—ë –Ω–∞–∑—ã–≤–∞—é—Ç ...",
        "answers": ["–¢–µ–Ω–¥–µ–Ω—Ü–∏–µ–π", "–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π", "–ì—Ä–∞—Ñ–∏–∫–æ–º", "–ü–∞—Ä–∞–º–µ—Ç—Ä–æ–º"],
        "correct": 1
    },
    {
        "question": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ –Ω–æ–≤–æ–º —Ä–∞–π–æ–Ω–µ. –ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ü–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–Ω–∞—Ç, –∑–∞—Ç–µ–º –æ—Ç —Ä–∞–π–æ–Ω–∞, –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –º–µ—Ç—Ä–æ –∏ –º–∞–≥–∞–∑–∏–Ω–∞–º. –ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∑–¥–µ—Å—å —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π?",
        "answers": ["–ö–æ–º–Ω–∞—Ç—ã", "–†–∞–π–æ–Ω", "–ú–µ—Ç—Ä–æ", "–¶–µ–Ω–∞"],
        "correct": 3
    },
    {
        "question": "–ß–µ–º –±–æ–ª—å—à–µ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç—Å—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω, —Ç–µ–º –º–µ–Ω—å—à–µ –µ–≥–æ –≤–µ—Å. –ö–∞–∫–æ–π –≤–∏–¥ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏ –≤–µ—Å–æ–º?",
        "answers": ["–û–±—Ä–∞—Ç–Ω–∞—è", "–ü—Ä—è–º–∞—è", "–†–æ–≤–Ω–∞—è", "–ì–ª–∞–¥–∫–∞—è"],
        "correct": 0
    },
    {
        "question": "–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, —Å–æ—Ö—Ä–∞–Ω—è—è –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
        "answers": ["LDA", "DimReducer", "PCA", "InfoCut"],
        "correct": 2
    },
    {
        "question": "–ü—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –º–æ–¥–µ–ª–∏ –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏, –º—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, —á—Ç–æ –º–µ–∂–¥—É –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä–∞–º–∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Å–∏–ª—å–Ω–∞—è",
        "answers": ["–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è", "–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞", "–°—Ç–∞–≥–Ω–∞—Ü–∏—è", "–≠–º–∏—Å—Å–∏—è"],
        "correct": 0
    },
    {
        "question": "–ö–æ–≥–¥–∞ —Å—Ä–µ–¥–∏ –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä–æ–≤ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∏–º–µ—é—â–∞—è –∑–Ω–∞—á–µ–Ω–∏—è –æ–≥—Ä–æ–º–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–æ–≤, –º—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å",
        "answers": ["–ò—Å–∫–∞–∂–µ–Ω–∏–µ", "–ü—Ä–∏—Ä–∞—â–µ–Ω–∏–µ", "–°–º–µ—â–µ–Ω–∏–µ", "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é"],
        "correct": 3
    },
    {
        "question": "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é '–ü–æ–ª' –≤ –±–∏–Ω–∞—Ä–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç",
        "answers": ["BinaryCoder", "SplitMapper", "LabelExpander", "OneHotEncoder"],
        "correct": 3
    },
    {
        "question": "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é",
        "answers": ["split_data", "train_test_split", "data_cut", "sample_divide"],
        "correct": 1
    },
    {
        "question": "–î–ª—è –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º—ã —Ö–æ—Ç–∏–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—á–µ—Ç–∞–µ—Ç –≤ —Å–µ–±–µ –ø–æ–¥—Ö–æ–¥—ã –∞–Ω–¥–µ—Ä—Å—ç–º–ø–ª–∏–Ω–≥–∞ (–¥–µ–ª–∞–µ–º –º–µ–Ω—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ç–∞–º, –≥–¥–µ —ç—Ç–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –º–Ω–æ–≥–æ) –∏ –±—É—Å—Ç–∏–Ω–≥–∞ (–æ–±—ä–µ–¥–∏–Ω—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–∞–±—ã—Ö –º–æ–¥–µ–ª–µ–π). –ò–∑ –Ω–∏–∂–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –≤—ã–±–µ—Ä–µ–º",
        "answers": ["BoostSampler", "EasyEnsemble", "ComboBoost", "MixBoost"],
        "correct": 1
    },
    {
        "question": "–í –∑–∞–¥–∞—á–µ –º–µ–∂–¥—É –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –∏ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –µ—Å—Ç—å –ø—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –¥–∞—Ç–∞—Å–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏. –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –º–æ–¥–µ–ª—å, —Ä–µ—à–∞—é—â–∞—è —Ç–∞–∫—É—é –∑–∞–¥–∞—á—É —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —ç—Ç–æ ___ —Ä–µ–≥—Ä–µ—Å—Å–∏—è",
        "answers": ["–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è", "–õ–∏–Ω–µ–π–Ω–∞—è", "SVR", "MixBoost"],
        "correct": 1
    },
    {
        "question": "–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –º–æ–¥–µ–ª—å –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Å–ø—Ä–∞–≤–∏–ª–∞—Å—å —Å –∑–∞–¥–∞—á–µ–π, –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫—É",
        "answers": ["RMSE", "ErrFit", "MSE", "LossSquare"],
        "correct": 2
    },
    {
        "question": "–î–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏, –Ω–∞–º –Ω—É–∂–Ω–∞ –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —à—Ç—Ä–∞—Ñ–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è 2 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–∞–∫ –æ–¥–Ω—É, –Ω–µ —É–¥–∞–ª—è—è –∏—Ö. –†–µ—á—å –∏–¥—ë—Ç –æ –º–µ—Ç–æ–¥–µ ...",
        "answers": ["Elastic", "DualFit", "SoftReg", "Ridge"],
        "correct": 3
    },
    {
        "question": "–ü–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –∫—Ä—É—Ç–∞, –Ω–æ –º—ã —Ä–µ—à–∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º–æ–π –∫–∞–∫ –ø–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è, –∞ –∏–∑–≥–∏–±–∞–µ—Ç—Å—è —Ç–∞–∫, –∫–∞–∫ –Ω—É–∂–Ω–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–π —Ç–æ—á–∫–∏ –∏ –Ω–∞—à –≤—ã–±–æ—Ä –ø–∞–ª –Ω–∞ ...",
        "answers": ["RBF SVR", "SplineNet", "FlexReg", "NonLinearSVR"],
        "correct": 0
    },
    {
        "question": "–†–µ—à–∞—è –∑–∞–¥–∞—á—É –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞–º –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∞—Å—å –ª–µ–≥–∫–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä—É—é –º—ã –º–æ–≥–ª–∏ –±—ã –∫—Ä–∞—Å–∏–≤–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ –≤–∏–¥–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏. –ö–æ–Ω–µ—á–Ω–æ –º—ã –≤—ã–±–µ—Ä–µ–º ...",
        "answers": ["ClassViz", "LogicMap", "RuleTree", "DecisionTree"],
        "correct": 3
    },
    {
        "question": "–ú—ã –∑–∞—Ä–∞–Ω–µ–µ –∑–Ω–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤, –≤—Å–µ –æ–Ω–∏ –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã, –∏–º–µ—é—Ç —Ñ–æ—Ä–º—É —Å—Ñ–µ—Ä. –õ—É—á—à–µ–µ —á—Ç–æ –º—ã –º–æ–∂–µ–º –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –∑–∞–¥–∞—á–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å",
        "answers": ["Centroider", "MeanCluster", "SpheriSplit", "K-Means"],
        "correct": 3
    },
    {
        "question": "–£ –Ω–∞—Å –Ω–µ–±–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ –∑–Ω–∞–µ–º –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤. –ü–ª—é—Å –∫–æ –≤—Å–µ–º—É, —Ö–æ—Ç–∏–º —Å–∞–º—É—é –ø—Ä–æ—Å—Ç—É—é –º–æ–¥–µ–ª—å –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è. –ú—ã –≤—ã–±–µ—Ä–µ–º –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ ...",
        "answers": ["SimpleSplit", "–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π", "ClustStep", "TopDown"],
        "correct": 1
    },
    {
        "question": "–û–¥–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –Ω–∞–º –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏ –º—ã —Ä–µ—à–∏–ª–∏ —Å–æ–±—Ä–∞—Ç—å –∏—Ö –≤–º–µ—Å—Ç–µ, —Å–æ–±–∏—Ä–∞—è –∏—Ö —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–µ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º ...",
        "answers": ["RandomForest", "DeepTrees", "TreeBag", "Forester"],
        "correct": 0
    },
    {
        "question": "–ù—É–∂–µ–Ω –º–µ—Ç–æ–¥, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–∞–±—ã—Ö –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç –≤–µ—Å –æ—à–∏–±–æ—á–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–±–ª—é–¥–µ–Ω–∏–π, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –æ–±—â—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∏ –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏. –ù–∞–º –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ –Ω—É–∂–µ–Ω",
        "answers": ["ErrorFixer", "BoostStep", "AdaBoost", "AdaFlow"],
        "correct": 2
    },
    {
        "question": "–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞ —ç—Ç–æ ...",
        "answers": ["TreePower", "XGBoost", "BoostNet", "XTree"],
        "correct": 1
    },
    {
        "question": "–í—ã –æ–ø–æ–∑–¥–∞–ª–∏ –Ω–∞ –∑–∞–Ω—è—Ç–∏–∏ –∏ —É—Å–ª—ã—à–∞–ª–∏ –æ—Ç—Ä—ã–≤–æ–∫ '... - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π —à–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥ —Å–ª–µ–¥—É—é—â–µ–º—É. –≠—Ç–æ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –≤ —Å–µ–±—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏.'. –í—ã —Å—Ä–∞–∑—É –ø–æ–Ω—è–ª–∏, —á—Ç–æ —Ç–µ–º–∞ –∑–∞–Ω—è—Ç–∏—è",
        "answers": ["ProcTrack", "StageMap", "Chainflow", "Pipeline"],
        "correct": 3
    },
    {
        "question": "–ü–æ–¥–µ–ª–∏–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ 5 –≥—Ä—É–ø–ø (–ø–∞—Ä—Ç–æ–≤), –±—É–¥–µ–º –æ–±—É—á–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∞ –º–æ–¥–µ–ª—å. –ú–µ—Ç–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è ...",
        "answers": ["Cross-validation", "SplitTest", "FoldEval", "TrainLoop"],
        "correct": 0
    },
    {
        "question": "–î–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã —Ä–∞—Å—Å–µ—è–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ plt. ...()",
        "answers": ["scatter", "dot", "cloud", "points"],
        "correct": 0
    },
    {
        "question": "–î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —è—â–∏–∫–∞ —Å —É—Å–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ plt. ...()",
        "answers": ["whiskers", "boxplot", "rangebox", "medplot"],
        "correct": 1
    },
    {
        "question": "–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∫–∏ –≤ –≥—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ plt. ...()",
        "answers": ["net", "lines", "grid", "mesh"],
        "correct": 2
    },
    {
        "question": "–î–æ–±–∞–≤–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫ –≥—Ä–∞—Ñ–∏–∫—É. –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ plt. ...()",
        "answers": ["caption", "label", "title", "header"],
        "correct": 2
    },
    {
        "question": "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—è —Ç–µ–∫—Å—Ç, –º–æ–¥–µ–ª—å NLP —Ä–µ—à–∏–ª–∞, —á—Ç–æ —Ç–µ–∫—Å—Ç –∏–º–µ–µ—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π ...",
        "answers": ["–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞", "—Å–µ–Ω—Ç–∏–º–µ–Ω—Ç", "–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "vibe"],
        "correct": 1
    },
    {
        "question": "–í—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ. '–†–∞–∑–±–∏—Ä–∞—è —Ç–µ–∫—Å—Ç, –º–æ–¥–µ–ª—å NLP –∏–∑–≤–ª–µ–∫–ª–∞ –≤—Å–µ ... —Å—É—â–Ω–æ—Å—Ç–∏'",
        "answers": ["–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ", "–≤–∞–∂–Ω—ã–µ", "–∫–ª—é—á–µ–≤—ã–µ", "—Ä–µ—á–µ–≤—ã–µ"],
        "correct": 0
    },
    {
        "question": "–ü—Ä–æ—Å—Ç–µ–π—à–∏–π –≤–∏–¥ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –Ω–µ–π—Ä–æ–Ω–∞, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –ª–∏–Ω–µ–π–Ω—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
        "answers": ["Neuronet", "ClassNode", "OneLine", "Perceptron"],
        "correct": 3
    },
    {
        "question": "–ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: –æ—Ç –≤—Ö–æ–¥–Ω–æ–≥–æ —Å–ª–æ—è –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ—ë–≤ —ç—Ç–æ",
        "answers": ["SeqNet", "FlatNet", "FFNN", "UniPass"],
        "correct": 2
    },
    {
        "question": "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è FFNN, –∏–º–µ—é—â–∞—è –±–æ–ª—å—à–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ—ë–≤ —ç—Ç–æ",
        "answers": ["DeepFF", "FullNet", "MultiFF", "DFF"],
        "correct": 3
    },
    {
        "question": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω—É–∂–µ–Ω —Ç–∏–ø –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏, –∏–º–µ—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–∞–º—è—Ç–∏. –î–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç",
        "answers": ["LoopNet", "RNN", "TimeNet", "TrackNet"],
        "correct": 1
    },
    {
        "question": "–í–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –º—ã —Ä–µ—à–∞–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏, —Å–ª—É—á–∞–π–Ω–æ –æ—Ç–∫–ª—é—á–∞—é—â–∏–π –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –Ω–µ–π—Ä–æ–Ω—ã. –î–ª—è —ç—Ç–æ–≥–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º",
        "answers": ["Dropout", "CutLayer", "NoiseOut", "NullNodes"],
        "correct": 0
    },
    {
        "question": "–°–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏",
        "answers": ["Ramp", "MaxZero", "ReLU", "CutAct"],
        "correct": 2
    },
    {
        "question": "'–ü—Ä–∏ –æ–±—Ä–∞—Ç–Ω–æ–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –≤–µ—Å–∞ —Å–ª–æ—ë–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ –∏–ª–∏ –≤–æ–≤—Å–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä–∏–º–µ—Ä –∏–∑-–∑–∞ —Ç–∞–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∫–∞–∫ Sigmoid –∏ Tanh, —Å–∂–∏–º–∞—é—â–∏—Ö —Å–≤–æ–∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –Ω–µ–±–æ–ª—å—à–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã'. –≠—Ç–æ –±—ã–ª–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å—á–µ–∑–∞—é—â–∏—Ö ...",
        "answers": ["–≤–µ—Å–æ–≤", "—Å–∏–≥–Ω–∞–ª–æ–≤", "–≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤", "—Å–ª–æ—ë–≤"],
        "correct": 2
    },
    {
        "question": "–ï—Å–ª–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞ –Ω–µ —É–ª—É—á—à–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–ø–æ—Ö, –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –æ–±—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–ª–ª–±—ç–∫",
        "answers": ["EarlyStopping", "StopLoss", "HaltTrain", "BreakEpoch"],
        "correct": 0
    },
    {
        "question": "–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ learning_rate –±—ã–ª –æ–≥—Ä–æ–º–µ–Ω, –Ω–æ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –µ–≥–æ —É–º–µ–Ω—å—à–∏—Ç—å, —á—Ç–æ–±—ã –æ–Ω '—Å–µ–º–∏–º–∏–ª—å–Ω—ã–º–∏ —à–∞–≥–∞–º–∏' –Ω–µ –ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞–ª –≤–∞–∂–Ω—ã–µ —Ç–æ—á–∫–∏ –º–∏–Ω–∏–º—É–º–∞. –î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–ª–ª–±—ç–∫ ReduceLR...",
        "answers": ["OnPlateu", "SoftDrop", "LevelWatch", "StepDecay"],
        "correct": 0
    },
    {
        "question": "–ö—Ç–æ –ª–µ–≥–µ–Ω–¥–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–æ–≤—ë–ª –¥–µ–ª–æ –¥–æ –∫–æ–Ω—Ü–∞?",
        "answers": ["–Ø", "–û–Ω", "–û–Ω–∞", "–û–Ω–∏"],
        "correct": 0
    }
]

async def generate_conversion_stats_by_source(stats):
    report = "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º**:\n\n"
    report += "| –ò—Å—Ç–æ—á–Ω–∏–∫ | –í—Å–µ–≥–æ | –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å | % –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π | –û–ø–ª–∞—Ç–∏–ª–∏ | % –û–ø–ª–∞—Ç –æ—Ç –≤—Å–µ—Ö | % –û–ø–ª–∞—Ç –æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö |\n"
    report += "|----------|-------|---------------------|----------------|----------|------------------|-----------------------------|\n"

    for stat in stats:
        report += f"| {stat['–ò—Å—Ç–æ—á–Ω–∏–∫']} | {stat['–í—Å–µ–≥–æ']} | {stat['–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å']} | {stat['% –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π']} | {stat['–û–ø–ª–∞—Ç–∏–ª–∏']} | {stat['% –û–ø–ª–∞—Ç –æ—Ç –≤—Å–µ—Ö']} | {stat['% –û–ø–ª–∞—Ç –æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö']} |\n"

    return report

async def generate_referral_conversion_stats(stats):
    report = "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º**:\n\n"
    report += "| –†–µ—Ñ–µ—Ä–µ—Ä ID | –ü—Ä–∏—à–ª–æ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–µ | –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å | % –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π | –û–ø–ª–∞—Ç–∏–ª–∏ | % –û–ø–ª–∞—Ç –æ—Ç –≤—Å–µ—Ö | % –û–ø–ª–∞—Ç –æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö |\n"
    report += "|------------|---------------------|---------------------|----------------|----------|------------------|-----------------------------|\n"

    for stat in stats:
        report += f"| {stat['–†–µ—Ñ–µ—Ä–µ—Ä ID']} | {stat['–ü—Ä–∏—à–ª–æ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–µ']} | {stat['–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å']} | {stat['% –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π']} | {stat['–û–ø–ª–∞—Ç–∏–ª–∏']} | {stat['% –û–ø–ª–∞—Ç –æ—Ç –≤—Å–µ—Ö']} | {stat['% –û–ø–ª–∞—Ç –æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö']} |\n"

    return report